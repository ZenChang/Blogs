
## 让你不再害怕指针

### 前言：复杂类型说明

从变量名处起，根据运算符优先级结合，一步一步分析。

int p; // 这是一个普通的整型变量

int *p;   // 首先从p处开始，先与*结合，所以说p是一个指针，
          // 然后再与int结合，说明指针指向的内容的类型为int型
          // 所以p是一个返回整型数据的指针
          
int p\[3\]; // 首先从p处开始，先与\[\]结合，说明p是一个数组，然后与int组合，
            // 说明数组里的元素是整型的，所以p是一个由整型数据组成的数组
            
int *p\[3\];  // 首先从p处开始，先与\[\]结合，因为其优先级比*高
              // 所以p是一个数组，然后再与*结合，说明
              // 数组里的元素是指针类型，然后再与int结合，
              // 说明指针所指向的内容类型是整型的，所以
              // p是一个由指向整型数据的指针所组成的数组
              
int (*p)\[3\];  // 首先从p处开始，先与*结合，说明p是一个指针，
                // 然后再与\[\]结合（与“（）”这步不可以忽略，因为改变了优先级）
                // 说明指针指向的内容是一个数组，然后再与int结合，
                // 说明了数组里的元素是整型的，所以p是一个指向由整型数据组成的
                // 数组的指针
                
int \**p;       // 首先从p开始，先是与*结合，说是p是一个指针，然后
                // 再与*结合，说明指针所指向的元素是指针，然后
                // 再与int结合，说明该指针所指向的元素是整型数据
                // 由于二级指针以及更高级的指针极少使用在复杂的类型中，
                // 所以后面复杂的类型我们就不考虑多级指针了，只考虑一级指针
                
int p(int);     // 从p处起，先与()结合，说明p是一个函数,然后进入
                // （）里面进行分析，说明该函数有一个整型变量的参数
                // 然后再与外面的int结合，说明函数的返回值是一个整型数据
                // 然后再与外面的int结合，说明函数的返回值是一个整型数据
                
int (*p)(int);  // 从p开始，先与指针结合，说明p是一个指针，然后与（）结合。
                // 然后与（）结合，说明指针指向的是一个函数，然后再与（）里面的int
                // 结合，说明函数有一个int型的参数，再与最外层的int结合
                // 说明函数的返回类型是整型，所以p是一个指向一个整型参数且
                // 返回类型为整型的函数的指针
                
int *(*p(int))\[3\];  // 从p开始，先与（）结合，说明p是一个函数，然后进入（）里面，与int结合，
                      // 说明函数有一个整型变量参数，然后再与外面的*结合，说明函数有一个整型变量
                      // 参数，然后再与外面的*结合，说明函数返回的是一个指针，然后到最外一层，先与
                      // \[\]结合，说明数组里的元素是指针，然后再与int结合，说明
                      // 指针指向的内容是整型数据，所以p是一个参数为一个整型数据且返回一个指向
                      // 由整型指针变量组成的数组的指针变量的函数。
                      
最后一个有点难，不会正常。
                
### 1. 细说指针

指针是一个特殊的变量，这个变量里面存储的数值被解释成内存里的一个地址。

指针四要素：指针的类型，指针所指向的类型，指针本身占据的内存区，指针的值或者叫指针所指向的内存区。

例一：

int * ptr;

char * ptr;

int ** ptr;

int (* ptr) \[3];

int * ( * ptr) \[4];

#### 1. 指针的类型

把指针声明语句里的指针名字去掉，剩下的部分就是这个指针的类型。

int * ptr;          // 指针的类型是int *

char * ptr;         // 指针的类型是char *

int ** ptr;         // 指针的类型是int **

int (* ptr) \[3];   // 指针的类型是int (*)\[3\];

int * (* ptr) \[4]; // 指针的类型是int * (*)\[4];

#### 2. 指针所指向的类型

当你通过指针来访问指针所指向的内存区时，指针所指向的类型决定了编译器把那边内存当做什么来看待。

把指针声明语句中的指针名字和名字左边的指针声明符*去掉，剩下的就是指针所指向的类型。

int * ptr;          // 指针指向的类型是int 

char * ptr;         // 指针指向的类型是char 

int ** ptr;         // 指针指向的类型是int *

int (* ptr) \[3];   // 指针指向的类型是int ()\[3\];

int * (* ptr) \[4]; // 指针指向的类型是int * ()\[4];

在指针的算术运算中，指针所指向的类型有很大的作用。

指针的类型（即指针本身的类型）和指针所指向的类型是两个概念。

### 3.指针的值----或者叫指针所指向的内存区域或地址

指针的值是指针本身存储的数值，这个值将被编译器当做一个地址，而不是一个一般的数值。

在32位程序里，所有类型的指针的值都是一个32位整数，因为32位程序里的内存地址都是32位长。

指针所指向的内存区就是从指针的值所代表的那个内存地址开始，长度为sizeof(指针所指向的类型)的一片内存区。

以后，我们说一个指针的值是XX，就相当于说该指针指向了以XX为首地址的一片内存区域；

我们说一个指针指向了某块内存区域，就相当于说该指针的值是这块内存区域的首地址。

指针指向的内存区和指针指向的类型是两个完全不同的概念。

在例一种，指针所指向的类型已经有了，但是由于指针还未初始化，所以

它指向的内存区是不存在的，或者说毫无意义的。

每遇到一个指针，都应该问问：这个指针的类型是什么？指针指向的类型是什么？ 该指针指向哪里？

### 4.指针本身所占据的内存区

指针本身占了多大的内存？

你只要用函数sizeof(指针的类型)测一下就知道了。在32位平台里，指针本身占据了4个字节的长度。

指针本身占据的内存这个概念在判断一个指针表达式是否左值时很有用。

## 2. 指针的算术运算

指针可以加上或减去一个整数。

指针的这种运算的意义和通常的数值的加减运算的意义是不一样的，以单元为单位。

例二：

char a\[20];

int * ptr = (int *)a;         // 强制类型转换不会改变a的类型。

在上例中，指针ptr的类型是int *，它指向的类型是int，他被初始化为指向整型变量a。

接下来的第三句














































